{"components":{"rows":[{"id":"GENERIC","name":"Generic","parent":"UnIqEiD","properties":[{"name":"Group","type":"Label","value":"Generic"}],"type":"Label","typeDesc":"\u003Ci\u003EGroup\u003C/i\u003E"},{"id":"fe11be1e-30eb-75e0-25cf-df1db037f2bf","parent":"GENERIC","properties":[{"name":"name","type":"Id","value":"newpass"},{"name":"propertyValue","type":"String","value":""},{"name":"parameterViewRole","type":"parameterViewRoleCustom","value":"unused"},{"name":"bookmarkable","type":"Boolean","value":"false"},{"name":"public","type":"Boolean","value":"false"}],"type":"ComponentsParameter","typeDesc":"Simple parameter"},{"id":"1bbcef32-cd6e-facd-5c7b-11ca1cafa370","parent":"GENERIC","properties":[{"name":"name","type":"Id","value":"verifypass"},{"name":"propertyValue","type":"String","value":""},{"name":"parameterViewRole","type":"parameterViewRoleCustom","value":"unused"},{"name":"bookmarkable","type":"Boolean","value":"false"},{"name":"public","type":"Boolean","value":"false"}],"type":"ComponentsParameter","typeDesc":"Simple parameter"},{"id":"935e1aed-fe04-4263-41e5-41a25b42c1b4","parent":"GENERIC","properties":[{"name":"name","type":"Id","value":"change"},{"name":"propertyValue","type":"String","value":"1"},{"name":"parameterViewRole","type":"parameterViewRoleCustom","value":"unused"},{"name":"bookmarkable","type":"Boolean","value":"false"},{"name":"public","type":"Boolean","value":"false"}],"type":"ComponentsParameter","typeDesc":"Simple parameter"},{"id":"OTHERCOMPONENTS","name":"Others","parent":"UnIqEiD","properties":[{"name":"Group","type":"Label","value":"Others"}],"type":"Label","typeDesc":"\u003Ci\u003EGroup\u003C/i\u003E"},{"id":"32c23199-1570-86bd-c4b3-006539bfda48","parent":"OTHERCOMPONENTS","properties":[{"name":"name","type":"Id","value":"btnChange"},{"name":"label","type":"String","value":"Change"},{"name":"listeners","type":"Listeners","value":"[]"},{"name":"actionParameters","type":"ValuesArray","value":"[]"},{"name":"expression","type":"JavaScript","value":"function() {\n    \n    newpass = document.getElementById(\u0022newPassTxt\u0022).value;\n    verifypass = document.getElementById(\u0022verifyPassTxt\u0022).value;\n    \n    Dashboards.fireChange(\u0027change\u0027 , (change + 1));\n    \n}"},{"name":"failureCallback","type":"JavaScript","value":""},{"name":"successCallback","type":"JavaScript","value":""},{"name":"dataSource","type":"Datasource","value":""},{"name":"priority","type":"Integer","value":5},{"name":"refreshPeriod","type":"Integer","value":""},{"name":"buttonStyle","type":"TableStyle","value":"classic"},{"name":"htmlObject","type":"HtmlObject","value":"${h:${p:btnChangeObject}}"},{"name":"executeAtStart","type":"Boolean","value":"true"},{"name":"preExecution","type":"JavaScript","value":""},{"name":"postExecution","type":"JavaScript","value":""},{"name":"tooltip","type":"Html","value":""}],"type":"ComponentsbuttonComponent","typeDesc":"Button Component"},{"id":"405fc45d-ffa7-eab7-be8f-76406667020f","parent":"OTHERCOMPONENTS","properties":[{"name":"name","type":"Id","value":"qryChangePass"},{"name":"listeners","type":"Listeners","value":"[\u0027${p:change}\u0027]"},{"name":"parameters","type":"ValuesArray","value":"[[\u0022newpass\u0022,\u0022newpass\u0022],[\u0022verifypass\u0022,\u0022verifypass\u0022]]"},{"name":"resultvar","type":"Result","value":""},{"name":"dataSource","type":"Datasource","value":"qryChangePassDS"},{"name":"asynchronousMode","type":"Boolean","value":"true"},{"name":"priority","type":"Integer","value":"5"},{"name":"refreshPeriod","type":"Integer","value":""},{"name":"htmlObject","type":"HtmlObject","value":"${p:msgBoxObject}"},{"name":"executeAtStart","type":"Boolean","value":"false"},{"name":"preExecution","type":"JavaScript","value":""},{"name":"postExecution","type":"JavaScript","value":""},{"name":"postFetch","type":"JavaScript","value":"function(data) {\n    \n    $(\u0022#msgBoxObject\u0022).removeAttr(\u0027class\u0027);\n    $(\u0022#msgBoxObject\u0022).addClass(data.resultset[0][1]);\n    \n    document.getElementById(\u0027msgBoxObject\u0027).innerHTML = data.resultset[0][0];\n    \n    document.getElementById(\u0022newPassTxt\u0022).value = \u0022\u0022;\n    document.getElementById(\u0022verifyPassTxt\u0022).value = \u0022\u0022;\n\n    \n}"},{"name":"preChange","type":"JavaScript","value":""},{"name":"postChange","type":"JavaScript","value":""},{"name":"tooltip","type":"Html","value":""}],"type":"ComponentsQuery","typeDesc":"Query Component"},{"id":"7cc7b538-2375-07cb-3418-9a87060b11b0","parent":"OTHERCOMPONENTS","properties":[{"name":"name","type":"Id","value":"refreshButton"},{"name":"label","type":"String","value":"Refresh"},{"name":"listeners","type":"Listeners","value":"[]"},{"name":"actionParameters","type":"ValuesArray","value":"[]"},{"name":"expression","type":"JavaScript","value":"function f(){\n    location.reload();    \n}"},{"name":"failureCallback","type":"JavaScript","value":""},{"name":"successCallback","type":"JavaScript","value":""},{"name":"dataSource","type":"Datasource","value":""},{"name":"priority","type":"Integer","value":5},{"name":"refreshPeriod","type":"Integer","value":""},{"name":"buttonStyle","type":"TableStyle","value":"themeroller"},{"name":"htmlObject","type":"HtmlObject","value":"${p:refreshButtonObj}"},{"name":"executeAtStart","type":"Boolean","value":"true"},{"name":"preExecution","type":"JavaScript","value":""},{"name":"postExecution","type":"JavaScript","value":""},{"name":"tooltip","type":"Html","value":""}],"type":"ComponentsbuttonComponent","typeDesc":"Button Component"}]},"datasources":{"rows":[{"id":"SQL","name":"SQL Queries","parent":"UnIqEiD","properties":[{"name":"Group","type":"Label","value":"SQL Queries"}],"type":"Label","typeDesc":"\u003Ci\u003EGroup\u003C/i\u003E"},{"id":"0a56c773-c21a-33cb-c9aa-716d1c31731a","meta":"CDA","meta_conntype":"sql.jndi","meta_datype":"sql","parent":"SQL","properties":[{"name":"name","type":"Id","value":"dummy"},{"name":"access","type":"Access","value":"public"},{"name":"jndi","type":"Jndi","value":""},{"name":"query","type":"SqlQuery","value":""},{"name":"parameters","type":"CdaParameters","value":"[]"},{"name":"cdacalculatedcolumns","type":"CdaCalculatedColumnsArray","value":"[]"},{"name":"cdacolumns","type":"CdaColumnsArray","value":"[]"},{"name":"output","type":"IndexArray","value":"[]"},{"name":"outputMode","type":"OutputMode","value":"include"},{"name":"cacheKeys","type":"CacheKeysValues","value":"[]"},{"name":"cacheDuration","type":"Integer","value":3600},{"name":"cache","type":"Boolean","value":"true"}],"type":"Componentssql_sqlJndi","typeDesc":"sql over sqlJndi"},{"id":"SCRIPTING","name":"SCRIPTING Queries","parent":"UnIqEiD","properties":[{"name":"Group","type":"Label","value":"SCRIPTING Queries"}],"type":"Label","typeDesc":"\u003Ci\u003EGroup\u003C/i\u003E"},{"id":"4c74eb13-2e06-00bc-06e5-2edf858c9179","meta":"CDA","meta_conntype":"scripting.scripting","meta_datype":"scriptable","parent":"SCRIPTING","properties":[{"name":"name","type":"Id","value":"qryChangePassDS"},{"name":"initscript","type":"String","value":""},{"name":"language","type":"String","value":"beanshell"},{"name":"access","type":"Access","value":"public"},{"name":"query","type":"SqlQuery","value":"import org.pentaho.reporting.engine.classic.core.util.TypedTableModel;\r\nimport org.json.simple.JSONObject;\r\nimport com.sun.jersey.api.client.Client;\r\nimport com.sun.jersey.api.client.ClientResponse;\r\nimport com.sun.jersey.api.client.config.ClientConfig;\r\nimport com.sun.jersey.api.client.config.DefaultClientConfig;\r\nimport com.sun.jersey.api.client.filter.LoggingFilter;\r\nimport com.sun.jersey.api.client.WebResource;\r\nimport com.sun.jersey.api.client.filter.HTTPBasicAuthFilter;\r\nimport org.pentaho.platform.engine.core.system.PentahoSystem;\r\nimport java.io.File;\r\nimport javax.xml.parsers.DocumentBuilderFactory;\r\nimport javax.xml.parsers.DocumentBuilder;\r\nimport org.w3c.dom.Document;\r\n\r\n\r\nString newpass = dataRow.get(\u0022newpass\u0022);\r\nString verifypass = dataRow.get(\u0022verifypass\u0022);\r\nString user = dataRow.get(\u0022user\u0022);\r\n\r\nString msg = \u0022-\u0022;\r\nString code = \u0022error\u0022;\r\n\r\n/***********************************************\r\n** Defines component return table\r\n***********************************************/\r\n\r\nString[] columnNames = new String[2];\r\ncolumnNames[0] = \u0022Message\u0022;\r\ncolumnNames[1] = \u0022Return Code\u0022;\r\n\r\nClass[] columnTypes = new Class[2];\r\ncolumnTypes[0] = String.class;\r\ncolumnTypes[1] = String.class;\r\n\r\nTypedTableModel model = new TypedTableModel(columnNames, columnTypes);\r\n\r\n/***********************************************\r\n** Validate password\r\n***********************************************/\r\n\r\nif (newpass.length() == 0) {\r\n    msg = \u0022Password can not be null.\u0022;\r\n} else if (newpass.length() \u003C 8) { \r\n    msg = \u0022Password can not be less than 8 characters.\u0022;\r\n} else if (!newpass.equals(verifypass)) {\r\n    msg = \u0022New Password and Verify Password are different.\u0022;\r\n} else {\r\n\r\n    /***********************************************\r\n    ** user / password to connect to Pentaho\r\n    ***********************************************/\r\n    \r\n    File xmlCfgFile = new File(PentahoSystem.getApplicationContext().getSolutionPath(\u0022system\u0022 + File.separator + \u0022changePassword\u0022 + File.separator) + \u0022cpp.xml\u0022);\r\n    \r\n    DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();\r\n    DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();\r\n    Document doc = dBuilder.parse(xmlCfgFile);\r\n    \r\n    String authUser = doc.getElementsByTagName(\u0022user\u0022).item(0).getTextContent();\r\n    String authPass = doc.getElementsByTagName(\u0022password\u0022).item(0).getTextContent();\r\n    \r\n    /***********************************************\r\n    ** Change password\r\n    ***********************************************/\r\n    \r\n    String mediaType = \u0022application/json;charset=UTF-8\u0022;\r\n    String baseUrl = PentahoSystem.getApplicationContext().getFullyQualifiedServerURL() + \u0022api/userroledao/updatePassword\u0022;\r\n        \t\r\n    ClientConfig config = new DefaultClientConfig();\r\n    Client jerseyClient = Client.create(config);\r\n    jerseyClient.addFilter(new LoggingFilter());\r\n\tjerseyClient.addFilter(new HTTPBasicAuthFilter(authUser, authPass));\r\n\r\n    \t\t\r\n    JSONObject inputJsonObj = new JSONObject();\r\n    /*inputJsonObj.put(\u0022administratorPassword\u0022,\u0022password\u0022);*/\r\n    //inputJsonObj.put(\u0022administratorPassword\u0022,authPass);\r\n    inputJsonObj.put(\u0022userName\u0022, user);\r\n    inputJsonObj.put(\u0022password\u0022, newpass);\r\n    \t\t\r\n    ClientResponse response = jerseyClient.resource(baseUrl).type(mediaType).put(ClientResponse.class, inputJsonObj.toJSONString());\t\r\n    \t\t\r\n    if (response.getClientResponseStatus() == ClientResponse.Status.OK) {\r\n        code = \u0022success\u0022;\r\n        msg = \u0022Password changed.\u0022;\r\n    } else {\r\n        msg = response.getClientResponseStatus().toString();\r\n    }\r\n   \r\n}\r\n\r\nmodel.addRow(new Object[]{ new String(msg), new String(code) });\r\nreturn model;\r\n\r\n"},{"name":"parameters","type":"CdaParameters","value":"[[\u0022newpass\u0022,\u0022\u0022,\u0022String\u0022,\u0022\u0022],[\u0022verifypass\u0022,\u0022\u0022,\u0022String\u0022,\u0022\u0022],[\u0022user\u0022,\u0022${[security:principalName]}\u0022,\u0022String\u0022,\u0022private\u0022]]"},{"name":"cdacalculatedcolumns","type":"CdaCalculatedColumnsArray","value":"[]"},{"name":"cdacolumns","type":"CdaColumnsArray","value":"[]"},{"name":"output","type":"IndexArray","value":"[]"},{"name":"outputMode","type":"OutputMode","value":"include"},{"name":"cacheKeys","type":"CacheKeysValues","value":"[]"},{"name":"cacheDuration","type":"Integer","value":3600},{"name":"cache","type":"Boolean","value":"false"}],"type":"Componentsscriptable_scripting","typeDesc":"scriptable over scripting"}]},"filename":"/system/changePassword/dashboards/changePassword.cdfde","layout":{"rows":[{"id":"6316466f-430d-3e25-75eb-481ba0dae11a","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"extraCSS"},{"name":"resourceCode","type":"Resource","value":"/* button {\n    background: linear-gradient(to bottom, #0C7297 0%, #095F7D 100%) repeat scroll 0 0 rgba(0, 0, 0, 0);\n    border: medium none;\n    border-radius: 5px;\n    box-shadow: 2px 2px 2px #C9CACB;\n    color: #FFFFFF;\n    cursor: pointer;\n    font-family: \u0027Open Sans Light\u0027,Arial,sans-serif;\n    font-size: 14px;\n    height: 32px;\n\n    padding-left: 10px;\n    padding-right: 10px;\n    width: 157px;\n}\nbutton:hover {\n    background: linear-gradient(to bottom, #29ABE2 0%, #0A6281 100%) repeat scroll 0 0 rgba(0, 0, 0, 0);\n} \n*/\n\nbutton {\n    background: transparent;\n    color: #cc0000;\n    filter: none;\n    border-radius: 4px;\n    -webkit-box-shadow: none;\n    box-shadow: none;\n    font-size: 14px;\n    font-weight: 400;\n    line-height: 20px;\n    padding: 9px 15px;\n    border: 1px solid #cc0000;\n}\nbutton:hover {\n   background: #cc0000 ;\n    color: white ;\n} "},{"name":"resourceType","type":"Label","value":"Css"}],"type":"LayoutResourceCode","typeDesc":"Resource"},{"id":"ba63720e-c34e-74e7-c9c6-e05b9ee99d8f","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"changepassword.css"},{"name":"resourceFile","type":"ResourceFile","value":"/pentaho/api/repos/changePassword/static/custom/css/changepassword.css"},{"name":"resourceType","type":"Label","value":"Css"}],"type":"LayoutResourceFile","typeDesc":"Resource"},{"id":"58382cf6-5fb6-76a9-d27f-637ad6c0a599","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"headerCell"},{"name":"height","type":"Integer","value":""},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":"WDheader"}],"type":"LayoutRow","typeDesc":"Row"},{"id":"de18b7e2-84f2-69b9-26c0-9a69d9e28d10","parent":"58382cf6-5fb6-76a9-d27f-637ad6c0a599","properties":[{"name":"name","type":"Id","value":"title"},{"name":"columnSpan","type":"Integer","value":""},{"name":"columnPrepend","type":"Integer","value":""},{"name":"columnAppend","type":"Integer","value":""},{"name":"columnPrependTop","type":"Boolean","value":"false"},{"name":"columnAppendBottom","type":"Boolean","value":"false"},{"name":"columnBorder","type":"Boolean","value":"false"},{"name":"columnBigBorder","type":"Boolean","value":"false"},{"name":"height","type":"Integer","value":""},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":"headerTitle"}],"type":"LayoutColumn","typeDesc":"Column"},{"id":"6b9e40a6-57b3-8d1e-073a-f85c9adcebfd","parent":"de18b7e2-84f2-69b9-26c0-9a69d9e28d10","properties":[{"name":"name","type":"Id","value":"pluginTitle"},{"name":"html","type":"Html","value":"Change Password "},{"name":"fontSize","type":"Integer","value":""},{"name":"color","type":"Color","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutHtml","typeDesc":"Html"},{"id":"eaf61a68-d242-b8b2-70f7-5a0722a2e38d","parent":"58382cf6-5fb6-76a9-d27f-637ad6c0a599","properties":[{"name":"name","type":"Id","value":"refreshButtonObj"},{"name":"columnSpan","type":"Integer","value":""},{"name":"columnPrepend","type":"Integer","value":""},{"name":"columnAppend","type":"Integer","value":""},{"name":"columnPrependTop","type":"Boolean","value":"false"},{"name":"columnAppendBottom","type":"Boolean","value":"false"},{"name":"columnBorder","type":"Boolean","value":"false"},{"name":"columnBigBorder","type":"Boolean","value":"false"},{"name":"height","type":"Integer","value":""},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":"refreshButtonCont"}],"type":"LayoutColumn","typeDesc":"Column"},{"id":"a424d366-dedf-4072-e312-9994effc0caf","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"newPasswordLine"},{"name":"height","type":"Integer","value":""},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":"label"}],"type":"LayoutRow","typeDesc":"Row"},{"id":"67938820-3fd5-9d69-d69e-353acdc982ad","parent":"a424d366-dedf-4072-e312-9994effc0caf","properties":[{"name":"name","type":"Id","value":""},{"name":"html","type":"Html","value":"New Password "},{"name":"fontSize","type":"Integer","value":""},{"name":"color","type":"Color","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutHtml","typeDesc":"Html"},{"id":"a911f78a-0b2e-a6f6-b5ec-b5bc894fae81","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"newPassObject"},{"name":"height","type":"Integer","value":""},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":"line"}],"type":"LayoutRow","typeDesc":"Row"},{"id":"64edf3ad-9766-5619-1eb2-f5f328af7a59","parent":"a911f78a-0b2e-a6f6-b5ec-b5bc894fae81","properties":[{"name":"name","type":"Id","value":""},{"name":"html","type":"Html","value":"\u003Cinput id=\u0022newPassTxt\u0022 type=\u0022password\u0022 value=\u0022\u0022 name=\u0022newPassTxt\u0022\u003E "},{"name":"fontSize","type":"Integer","value":""},{"name":"color","type":"Color","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutHtml","typeDesc":"Html"},{"id":"5c409222-aa53-dc55-32a0-678f98eff032","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"verifyPasswordLine"},{"name":"height","type":"Integer","value":""},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":"label"}],"type":"LayoutRow","typeDesc":"Row"},{"id":"cca0f92b-606f-993e-41ab-b4430ad44654","parent":"5c409222-aa53-dc55-32a0-678f98eff032","properties":[{"name":"name","type":"Id","value":""},{"name":"html","type":"Html","value":"Verify Password "},{"name":"fontSize","type":"Integer","value":""},{"name":"color","type":"Color","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutHtml","typeDesc":"Html"},{"id":"75d461fe-47d0-5d82-1676-df4937a2672a","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"verifyPassObject"},{"name":"height","type":"Integer","value":""},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":"line"}],"type":"LayoutRow","typeDesc":"Row"},{"id":"5f7971b2-18f7-274d-cbc8-a26e335ee41f","parent":"75d461fe-47d0-5d82-1676-df4937a2672a","properties":[{"name":"name","type":"Id","value":""},{"name":"html","type":"Html","value":"\u003Cinput id=\u0022verifyPassTxt\u0022 type=\u0022password\u0022 value=\u0022\u0022 name=\u0022verifyPassTxt\u0022\u003E "},{"name":"fontSize","type":"Integer","value":""},{"name":"color","type":"Color","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutHtml","typeDesc":"Html"},{"id":"8a446daa-4e0a-dfc0-cea8-a625a62d0a5b","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"btnChangeObject"},{"name":"height","type":"Integer","value":""},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutRow","typeDesc":"Row"},{"id":"7f95166b-41d6-1e7e-fa2f-4b466611b667","parent":"UnIqEiD","properties":[{"name":"name","type":"Id","value":"msgBoxObject"},{"name":"height","type":"Integer","value":""},{"name":"backgroundColor","type":"Color","value":""},{"name":"roundCorners","type":"RoundCorners","value":""},{"name":"textAlign","type":"TextAlign","value":""},{"name":"cssClass","type":"String","value":""}],"type":"LayoutRow","typeDesc":"Row"}],"title":"changePassword"}}